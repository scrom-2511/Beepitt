// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum SubscriptionTier {
  Free
  Premium
}

enum AuthProvider {
  LOCAL
  GOOGLE
  DISCORD
}

model User {
  id                Int              @id @default(autoincrement())
  otpVerified       Boolean          @default(false)
  identifierKey     String           @unique
  username          String           @unique
  firstName         String?
  lastName          String?
  email             String           @unique
  password          String
  city              String?
  timezone          String?
  subscription_tier SubscriptionTier
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  authAccounts   AuthAccount[]
  incidents      Incident[]
  contactDetails ContactDetails?
  orders         Orders[]
}

model AuthAccount {
  id         Int          @id @default(autoincrement())
  provider   AuthProvider
  providerId String       @unique
  userId     Int

  user User @relation(fields: [userId], references: [id])
}

enum IncidentPriority {
  Unseen
  Critical
  High
  Low
  Closed
}

model Incident {
  id                         Int               @id @default(autoincrement())
  incidentName               String
  incidentDesc               String
  incidentPriority           IncidentPriority?
  incidentDateAndTime        DateTime          @default(now())
  incidentResolveDateAndTime DateTime?
  userId                     Int
  user                       User              @relation(fields: [userId], references: [id])
}

model ContactDetails {
  id              Int      @id @default(autoincrement())
  telegramChatIds String[]
  discordChatIds  String[]
  userId          Int      @unique
  user            User     @relation(fields: [userId], references: [id])
}

enum OrderStatus {
  Started
  Pending
  Frontend_Success
  Successful
  Failed
}

model Orders {
  id                Int         @id @default(autoincrement())
  razorPayOrderId   String      @unique
  razorPayPaymentId String?
  amount            Int
  status            OrderStatus
  note              String?
  userId            Int
  user              User        @relation(fields: [userId], references: [id])
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @default(now()) @updatedAt
}
